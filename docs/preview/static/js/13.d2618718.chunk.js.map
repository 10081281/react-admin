{"version":3,"sources":["pages/product/EditModal.jsx","pages/product/index.jsx"],"names":["EditModal","config","ajax","modal","title","props","isEdit","state","loading","data","fetchData","id","setState","get","then","res","Object","entries","forEach","key","undefined","form","setFieldsValue","finally","handleSubmit","values","successTip","ajaxMethod","put","post","onOk","this","formProps","labelWidth","okText","cancelText","submit","onCancel","resetFields","name","initialValues","ref","onFinish","type","label","maxLength","required","Component","UserCenter","path","dataSource","selectedRowKeys","total","pageNum","pageSize","deleting","visible","columns","dataIndex","width","render","value","record","items","onClick","color","confirm","onConfirm","handleDelete","params","list","del","errorTip","handleBatchDelete","content","style","padding","fontSize","length","ids","disabledDelete","danger","disabled","serialNumber","rowSelection","onChange","rowKey","onPageNumChange","onPageSizeChange"],"mappings":"ySAYqBA,EANpBC,YAAO,CACJC,MAAM,EACNC,MAAO,CACHC,MAAO,SAAAC,GAAK,OAAIA,EAAMC,OAAS,eAAO,kB,+MAI1CC,MAAQ,CACJC,SAAS,EACTC,KAAM,I,EAWVC,UAAY,WACR,IAAI,EAAKH,MAAMC,QAAf,CADc,IAGPG,EAAM,EAAKN,MAAXM,GAEP,EAAKC,SAAS,CAACJ,SAAS,IACxB,EAAKH,MAAMH,KAAKW,IAAhB,oBAAiCF,IAC5BG,MAAK,SAAAC,GACF,EAAKH,SAAS,CAACH,KAAMM,IAGrBC,OAAOC,QAAQF,GAAKG,SAAQ,YAAmB,IAAD,mBAAhBC,EAAgB,KAC5B,OAD4B,OACtBJ,EAAII,QAAOC,MAGnC,EAAKC,KAAKC,eAAeP,MAE5BQ,SAAQ,kBAAM,EAAKX,SAAS,CAACJ,SAAS,S,EAG/CgB,aAAe,SAACC,GACZ,IAAI,EAAKlB,MAAMC,QAAf,CADuB,IAGhBF,EAAU,EAAKD,MAAfC,OACDoB,EAAapB,EAAS,iCAAU,iCAChCqB,EAAarB,EAAS,EAAKD,MAAMH,KAAK0B,IAAM,EAAKvB,MAAMH,KAAK2B,KAGlE,EAAKjB,SAAS,CAACJ,SAAS,IACxBmB,EAHyB,YAGLF,EAAQ,CAACC,eACxBZ,MAAK,WAAO,IACFgB,EAAQ,EAAKzB,MAAbyB,KACPA,GAAQA,OAEXP,SAAQ,kBAAM,EAAKX,SAAS,CAACJ,SAAS,S,kEAzC1BuB,KAAK1B,MAAfC,QAGHyB,KAAKrB,c,+BAyCH,IAAD,OACEJ,EAAUyB,KAAK1B,MAAfC,OADF,EAEmByB,KAAKxB,MAAtBC,EAFF,EAEEA,QAASC,EAFX,EAEWA,KACVuB,EAAY,CACdC,WAAY,KAEhB,OACI,kBAAC,IAAD,CACIzB,QAASA,EACT0B,OAAO,eACPC,WAAW,eACXL,KAAM,kBAAM,EAAKT,KAAKe,UACtBC,SAAU,kBAAM,EAAKhB,KAAKiB,gBAE1B,6BACIC,KAAK,qBACLC,cAAe/B,EACfgC,IAAK,SAAApB,GAAI,OAAI,EAAKA,KAAOA,GACzBqB,SAAUX,KAAKP,cAEdlB,EAAS,kBAAC,IAAD,iBAAiB0B,EAAjB,CAA4BW,KAAK,SAASJ,KAAK,QAAS,KAClE,kBAAC,IAAD,iBACQP,EADR,CAEIY,MAAM,eACNL,KAAK,cACLM,UAAW,OAEf,kBAAC,IAAD,iBACQb,EADR,CAEIY,MAAM,2BACNL,KAAK,OACLO,UAAQ,EACRD,UAAW,Y,GAnFIE,e,ECIlBC,EAJpB/C,YAAO,CACJgD,KAAM,YACN/C,MAAM,G,+MAGNK,MAAQ,CACJC,SAAS,EACT0C,WAAY,GACZC,gBAAiB,GACjBC,MAAO,EACPC,QAAS,EACTC,SAAU,GACVC,UAAU,EACVC,SAAS,EACT7C,GAAI,M,EAGR8C,QAAU,CACN,CAACrD,MAAO,eAAMsD,UAAW,cAAeC,MAAO,KAC/C,CAACvD,MAAO,2BAAQsD,UAAW,OAAQC,MAAO,KAC1C,CACIvD,MAAO,eAAMsD,UAAW,WAAYC,MAAO,IAC3CC,OAAQ,SAACC,EAAOC,GAAY,IACjBnD,EAAYmD,EAAZnD,GAAI4B,EAAQuB,EAARvB,KACLwB,EAAQ,CACV,CACInB,MAAO,eACPoB,QAAS,kBAAM,EAAKpD,SAAS,CAAC4C,SAAS,EAAM7C,SAEjD,CACIiC,MAAO,eACPqB,MAAO,MACPC,QAAS,CACL9D,MAAM,kCAAD,OAAWmC,EAAX,MACL4B,UAAW,kBAAM,EAAKC,aAAazD,OAM/C,OAAO,kBAAC,IAAD,CAAUoD,MAAOA,O,EASpCvC,aAAe,SAACC,GACZ,IAAI,EAAKlB,MAAMC,QAAf,CADuB,MAGK,EAAKD,MAC3B8D,EAAS,CACXhB,QALmB,EAGhBA,QAGHC,SANmB,EAGPA,UAMhB,EAAK1C,SAAS,CAACJ,SAAS,IACxB,EAAKH,MAAMH,KAAKW,IAAI,YAAawD,GAC5BvD,MAAK,SAAAC,GACF,IAAMmC,GAAgB,OAAHnC,QAAG,IAAHA,OAAA,EAAAA,EAAKuD,OAAQ,GAC1BlB,GAAW,OAAHrC,QAAG,IAAHA,OAAA,EAAAA,EAAKqC,QAAS,EAE5B,EAAKxC,SAAS,CAACsC,aAAYE,aAE9B7B,SAAQ,kBAAM,EAAKX,SAAS,CAACJ,SAAS,S,EAG/C4D,aAAe,SAACzD,GACT,EAAKJ,MAAMgD,WAEd,EAAK3C,SAAS,CAAC2C,UAAU,IACzB,EAAKlD,MAAMH,KAAKqE,IAAhB,oBAAiC5D,GAAM,KAAM,CAACe,WAAY,iCAAS8C,SAAU,mCACxE1D,MAAK,kBAAM,EAAKO,KAAKe,YACrBb,SAAQ,kBAAM,EAAKX,SAAS,CAAC2C,UAAU,S,EAGhDkB,kBAAoB,WAChB,IAAI,EAAKlE,MAAMgD,SAAf,CADsB,IAGfJ,EAAmB,EAAK5C,MAAxB4C,gBACDuB,EACF,+DAEI,0BAAMC,MAAO,CAACC,QAAS,QAASX,MAAO,MAAOY,SAAU,KACnD1B,EAAgB2B,QAHzB,kCAQJ,UAAMZ,QAAQ,CACV9D,MAAO,2BACPsE,UACA5C,KAAM,WACF,EAAKlB,SAAS,CAAC2C,UAAU,IACzB,EAAKlD,MAAMH,KAAKqE,IAAI,YAAa,CAACQ,IAAK5B,GAAkB,CAACzB,WAAY,iCAAS8C,SAAU,mCACpF1D,MAAK,kBAAM,EAAKO,KAAKe,YACrBb,SAAQ,kBAAM,EAAKX,SAAS,CAAC2C,UAAU,Y,kEApDpDxB,KAAKP,iB,+BAyDC,IAAD,SAWDO,KAAKxB,MATLC,EAFC,EAEDA,QACA+C,EAHC,EAGDA,SACAL,EAJC,EAIDA,WACAC,EALC,EAKDA,gBACAC,EANC,EAMDA,MACAC,EAPC,EAODA,QACAC,EARC,EAQDA,SACAE,EATC,EASDA,QACA7C,EAVC,EAUDA,GAGEqE,IAAiB,OAAC7B,QAAD,IAACA,OAAD,EAACA,EAAiB2B,QAEzC,OACI,kBAAC,IAAD,CAAatE,QAASA,GAAW+C,GAC7B,kBAAC,IAAD,KACI,6BAAQZ,KAAK,UAAUqB,QAAS,kBAAM,EAAKpD,SAAS,CAAC4C,SAAS,EAAM7C,GAAI,SAAxE,gBACA,6BAAQsE,QAAM,EAACC,SAAUF,EAAgBhB,QAASjC,KAAK0C,mBAAvD,iBAEJ,kBAAC,IAAD,CACIU,cAAY,EACZC,aAAc,CACVjC,kBACAkC,SAAU,SAAAlC,GAAe,OAAI,EAAKvC,SAAS,CAACuC,sBAEhDM,QAAS1B,KAAK0B,QACdP,WAAYA,EACZoC,OAAO,KACPjC,QAASA,EACTC,SAAUA,IAEd,kBAAC,IAAD,CACIF,MAAOA,EACPC,QAASA,EACTC,SAAUA,EACViC,gBAAiB,SAAAlC,GAAO,OAAI,EAAKzC,SAAS,CAACyC,YAAU,kBAAM,EAAKhC,KAAKe,aACrEoD,iBAAkB,SAAAlC,GAAQ,OAAI,EAAK1C,SAAS,CAAC0C,WAAUD,QAAS,IAAI,kBAAM,EAAKhC,KAAKe,eAExF,kBAAC,EAAD,CACIoB,QAASA,EACT7C,GAAIA,EACJL,OAAe,OAAPK,EACRmB,KAAM,kBAAM,EAAKlB,SAAS,CAAC4C,SAAS,IAAQ,kBAAM,EAAKnC,KAAKe,aAC5DC,SAAU,kBAAM,EAAKzB,SAAS,CAAC4C,SAAS,Y,GAhJpBT,e","file":"static/js/13.d2618718.chunk.js","sourcesContent":["import React, {Component} from 'react';\nimport {Form} from 'antd';\nimport {FormElement} from 'src/library/components';\nimport config from 'src/commons/config-hoc';\nimport {ModalContent} from 'src/library/components';\n\n@config({\n    ajax: true,\n    modal: {\n        title: props => props.isEdit ? '修改' : '添加',\n    },\n})\nexport default class EditModal extends Component {\n    state = {\n        loading: false, // 页面加载loading\n        data: {},       // 回显数据\n    };\n\n    componentDidMount() {\n        const {isEdit} = this.props;\n\n        if (isEdit) {\n            this.fetchData();\n        }\n    }\n\n    fetchData = () => {\n        if (this.state.loading) return;\n\n        const {id} = this.props;\n\n        this.setState({loading: true});\n        this.props.ajax.get(`/products/${id}`)\n            .then(res => {\n                this.setState({data: res});\n\n                // 不处理null，下拉框不显示placeholder\n                Object.entries(res).forEach(([key, value]) => {\n                    if (value === null) res[key] = undefined;\n                });\n\n                this.form.setFieldsValue(res);\n            })\n            .finally(() => this.setState({loading: false}));\n    };\n\n    handleSubmit = (values) => {\n        if (this.state.loading) return;\n\n        const {isEdit} = this.props;\n        const successTip = isEdit ? '修改成功！' : '添加成功！';\n        const ajaxMethod = isEdit ? this.props.ajax.put : this.props.ajax.post;\n        const ajaxUrl = isEdit ? '/products' : '/products';\n\n        this.setState({loading: true});\n        ajaxMethod(ajaxUrl, values, {successTip})\n            .then(() => {\n                const {onOk} = this.props;\n                onOk && onOk();\n            })\n            .finally(() => this.setState({loading: false}));\n    };\n\n    render() {\n        const {isEdit} = this.props;\n        const {loading, data} = this.state;\n        const formProps = {\n            labelWidth: 100,\n        };\n        return (\n            <ModalContent\n                loading={loading}\n                okText=\"保存\"\n                cancelText=\"重置\"\n                onOk={() => this.form.submit()}\n                onCancel={() => this.form.resetFields()}\n            >\n                <Form\n                    name=\"product-modal-edit\"\n                    initialValues={data}\n                    ref={form => this.form = form}\n                    onFinish={this.handleSubmit}\n                >\n                    {isEdit ? <FormElement {...formProps} type=\"hidden\" name=\"id\"/> : null}\n                    <FormElement\n                        {...formProps}\n                        label=\"描述\"\n                        name=\"description\"\n                        maxLength={200}\n                    />\n                    <FormElement\n                        {...formProps}\n                        label=\"产品名称\"\n                        name=\"name\"\n                        required\n                        maxLength={50}\n                    />\n                </Form>\n            </ModalContent>\n        );\n    }\n}\n","import React, {Component} from 'react';\nimport {Button, Modal} from 'antd';\nimport PageContent from 'src/layouts/page-content';\nimport config from 'src/commons/config-hoc';\nimport {\n    ToolBar,\n    Table,\n    Operator,\n    Pagination,\n} from 'src/library/components';\nimport EditModal from './EditModal';\n\n@config({\n    path: '/products',\n    ajax: true,\n})\nexport default class UserCenter extends Component {\n    state = {\n        loading: false,     // 表格加载数据loading\n        dataSource: [],     // 表格数据\n        selectedRowKeys: [],// 表格中选中行keys\n        total: 0,           // 分页中条数\n        pageNum: 1,         // 分页当前页\n        pageSize: 20,       // 分页每页显示条数\n        deleting: false,    // 删除中loading\n        visible: false,     // 添加、修改弹框\n        id: null,           // 需要修改的数据id\n    };\n\n    columns = [\n        {title: '描述', dataIndex: 'description', width: 200},\n        {title: '产品名称', dataIndex: 'name', width: 200},\n        {\n            title: '操作', dataIndex: 'operator', width: 100,\n            render: (value, record) => {\n                const {id, name} = record;\n                const items = [\n                    {\n                        label: '修改',\n                        onClick: () => this.setState({visible: true, id}),\n                    },\n                    {\n                        label: '删除',\n                        color: 'red',\n                        confirm: {\n                            title: `您确定删除\"${name}\"?`,\n                            onConfirm: () => this.handleDelete(id),\n                        },\n                    },\n                    \n                ];\n\n                return <Operator items={items}/>\n            },\n        },\n    ];\n\n    componentDidMount() {\n        this.handleSubmit();\n    }\n\n    handleSubmit = (values) => {\n        if (this.state.loading) return;\n\n        const {pageNum, pageSize} = this.state;\n        const params = {\n            pageNum,\n            pageSize,\n        };\n\n        this.setState({loading: true});\n        this.props.ajax.get('/products', params)\n            .then(res => {\n                const dataSource = res?.list || [];\n                const total = res?.total || 0;\n\n                this.setState({dataSource, total});\n            })\n            .finally(() => this.setState({loading: false}));\n    };\n\n    handleDelete = (id) => {\n        if(this.state.deleting) return;\n\n        this.setState({deleting: true});\n        this.props.ajax.del(`/products/${id}`, null, {successTip: '删除成功！', errorTip: '删除失败！'})\n            .then(() => this.form.submit())\n            .finally(() => this.setState({deleting: false}));\n    };\n\n    handleBatchDelete = () => {\n        if (this.state.deleting) return;\n\n        const {selectedRowKeys} = this.state;\n        const content = (\n            <span>\n                您确定删除\n                <span style={{padding: '0 5px', color: 'red', fontSize: 18}}>\n                    {selectedRowKeys.length}\n                </span>\n                条记录吗？\n            </span>\n        );\n        Modal.confirm({\n            title: '温馨提示',\n            content,\n            onOk: () => {\n                this.setState({deleting: true});\n                this.props.ajax.del('/products', {ids: selectedRowKeys}, {successTip: '删除成功！', errorTip: '删除失败！'})\n                    .then(() => this.form.submit())\n                    .finally(() => this.setState({deleting: false}));\n            },\n        })\n    };\n\n    render() {\n        const {\n            loading,\n            deleting,\n            dataSource,\n            selectedRowKeys,\n            total,\n            pageNum,\n            pageSize,\n            visible,\n            id,\n        } = this.state;\n\n        const disabledDelete = !selectedRowKeys?.length;\n\n        return (\n            <PageContent loading={loading || deleting}>\n                <ToolBar>\n                    <Button type=\"primary\" onClick={() => this.setState({visible: true, id: null})}>添加</Button>\n                    <Button danger disabled={disabledDelete} onClick={this.handleBatchDelete}>删除</Button>\n                </ToolBar>\n                <Table\n                    serialNumber\n                    rowSelection={{\n                        selectedRowKeys,\n                        onChange: selectedRowKeys => this.setState({selectedRowKeys}),\n                    }}\n                    columns={this.columns}\n                    dataSource={dataSource}\n                    rowKey=\"id\"\n                    pageNum={pageNum}\n                    pageSize={pageSize}\n                />\n                <Pagination\n                    total={total}\n                    pageNum={pageNum}\n                    pageSize={pageSize}\n                    onPageNumChange={pageNum => this.setState({pageNum}, () => this.form.submit())}\n                    onPageSizeChange={pageSize => this.setState({pageSize, pageNum: 1}, () => this.form.submit())}\n                />\n                <EditModal\n                    visible={visible}\n                    id={id}\n                    isEdit={id !== null}\n                    onOk={() => this.setState({visible: false}, () => this.form.submit())}\n                    onCancel={() => this.setState({visible: false})}\n                />\n            </PageContent>\n        );\n    }\n}\n"],"sourceRoot":""}